{"Name":"Ping","Description":"Test connectivity to GitSync","Script":"# Copyright 2025 Google LLC\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\nfrom __future__ import annotations\n\nimport re\n\nfrom SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import output_handler\n\nfrom GitManager import GitSyncException\nfrom constants import COMMIT_AUTHOR_REGEX, DEFAULT_AUTHOR, DEFAULT_USERNAME\nfrom GitSyncManager import GitSyncManager\n\nSCRIPT_NAME = \"Ping\"\nINTEGRATION_NAME = \"GitSync\"\n\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n    siemplify.script_name = SCRIPT_NAME\n    smp_credentials = {}\n    repo_url = siemplify.extract_configuration_param(INTEGRATION_NAME, \"Repo URL\")\n    branch = siemplify.extract_configuration_param(INTEGRATION_NAME, \"Branch\")\n    git_server_fingerprint = siemplify.extract_configuration_param(\n        INTEGRATION_NAME,\n        \"Git Server Fingerprint\",\n        print_value=True,\n        default_value=\"\",\n    )\n    git_password = siemplify.extract_configuration_param(\n        INTEGRATION_NAME,\n        \"Git Password/Token/SSH Key\",\n    )\n    git_username = siemplify.extract_configuration_param(\n        INTEGRATION_NAME,\n        \"Git Username\",\n        default_value=DEFAULT_USERNAME,\n    )\n    git_author = siemplify.extract_configuration_param(\n        INTEGRATION_NAME,\n        \"Commit Author\",\n        default_value=DEFAULT_AUTHOR,\n    )\n    smp_credentials[\"username\"] = siemplify.extract_configuration_param(\n        INTEGRATION_NAME,\n        \"SOAR Username\",\n        print_value=True,\n        default_value=None,\n    )\n    smp_credentials[\"password\"] = siemplify.extract_configuration_param(\n        provider_name=INTEGRATION_NAME,\n        param_name=\"SOAR Password\",\n    )\n    smp_verify = siemplify.extract_configuration_param(\n        INTEGRATION_NAME,\n        \"Siemplify Verify SSL\",\n        input_type=bool,\n    )\n    git_verify = siemplify.extract_configuration_param(\n        INTEGRATION_NAME,\n        \"Git Verify SSL\",\n        input_type=bool,\n    )\n\n    if not re.fullmatch(COMMIT_AUTHOR_REGEX, git_author):\n        raise Exception(\n            \"Commit Author parameter must be in the following format: Name <example@gmail.com>\",\n        )\n\n    try:\n        gitsync = GitSyncManager(\n            siemplify,\n            repo_url,\n            branch,\n            git_password,\n            git_username,\n            git_author,\n            smp_credentials,\n            smp_verify,\n            git_verify,\n            git_server_fingerprint,\n        )\n    except Exception as e:\n        raise Exception(f\"Couldn't connect to git\\nError: {e}\")\n\n    test_connectivity(gitsync, siemplify)\n\n    # Test Git connectivity with fingerprint verification (only if the optional fingerprint is provided)\n    if git_server_fingerprint.strip():\n        connect_to_git_server_to_verify_fingerprint(siemplify, gitsync)\n    else:\n        siemplify.LOGGER.info(\n            \"No git server fingerprint provided - skipping fingerprint verification test\"\n        )\n\n    siemplify.end(\"True\", True)\n\n\ndef test_connectivity(gitsync: GitSyncManager, siemplify: SiemplifyAction) -> None:\n    try:\n        gitsync.api.test_connectivity()\n        siemplify.LOGGER.info(\"Chronicle SOAR connection successful\")\n    except Exception as e:\n        raise ConnectionError(\"Couldn't connect to Chronicle SOAR\") from e\n\n\ndef connect_to_git_server_to_verify_fingerprint(\n    siemplify: SiemplifyAction, gitsync: GitSyncManager\n) -> None:\n    \"\"\"Connect to the Git server and verify the fingerprint.\"\"\"\n    try:\n        gitsync.git_client.get_head_tree()\n        siemplify.LOGGER.info(\"Git connection and fingerprint verification successful\")\n    except Exception as e:\n        siemplify.LOGGER.exception(e)\n        raise GitSyncException(\n            f\"Git connection failed (fingerprint verification may have failed): {e}\"\n        )\n\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"GitSyncPlayground","ScriptResultName":"is_success","DynamicResultsMetadata":[],"Creator":"Admin","IsEnabled":true,"IsCustom":true,"IsSystem":false,"Version":1.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[],"DefaultResultValue":null,"PythonVersion":"None","SimulationData":{"Entities":[]},"SimulationDataJson":"{\"Entities\": []}"}