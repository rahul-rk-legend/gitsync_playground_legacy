{
    "lastRunStatus": 0,
    "lastRunTime": 1764913249401,
    "uniqueIdentifier": "98710597-26fd-4bf2-b7d7-0a4389cba1f0",
    "id": 0,
    "jobDefinitionId": 0,
    "name": "Push Contents",
    "integration": "GitSyncPlayground",
    "script": "# Copyright 2025 Google LLC\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\nfrom __future__ import annotations\n\nfrom io import BytesIO\n\nfrom SiemplifyJob import SiemplifyJob\nfrom SiemplifyUtils import output_handler\n\nfrom constants import (\n    ALL_ENVIRONMENTS_IDENTIFIER,\n    AVAILABLE_CONTENT,\n    IGNORED_INTEGRATIONS,\n    IGNORED_JOBS,\n    INTEGRATION_NAME,\n)\nfrom definitions import (\n    Connector,\n    Integration,\n    Job,\n    Mapping,\n    VisualFamily,\n    Workflow,\n)\nfrom GitSyncManager import GitSyncManager\n\nSCRIPT_NAME = \"Push Content\"\n\n\n@output_handler\ndef main():\n    siemplify = SiemplifyJob()\n    siemplify.script_name = SCRIPT_NAME\n\n    commit_msg = siemplify.extract_job_param(\"Commit\")\n    commit_passwords = siemplify.extract_job_param(\"Commit Passwords\", input_type=bool)\n\n    # Features\n    features = {}\n    for feature in AVAILABLE_CONTENT:\n        features[feature] = siemplify.extract_job_param(feature, input_type=bool)\n\n    try:\n        gitsync = GitSyncManager.from_siemplify_object(siemplify)\n\n        # Integrations\n        if features[\"Integrations\"]:\n            siemplify.LOGGER.info(\"========== Integrations ==========\")\n            for integration in [\n                x\n                for x in gitsync.api.get_ide_cards()\n                if x.get(\"identifier\") not in IGNORED_INTEGRATIONS\n            ]:\n                siemplify.LOGGER.info(f\"Pushing {integration['identifier']}\")\n                integration_obj = Integration(\n                    integration,\n                    BytesIO(gitsync.api.export_package(integration[\"identifier\"])),\n                )\n                try:\n                    gitsync.content.push_integration(integration_obj)\n                except Exception as e:\n                    siemplify.LOGGER.error(\n                        f\"Couldn't upload {integration_obj.identifier}. ERROR: {e}\",\n                    )\n\n        # Playbooks\n        if features[\"Playbooks\"]:\n            siemplify.LOGGER.info(\"========== Playbooks ==========\")\n            for playbook in gitsync.api.get_playbooks(chronicle_soar=siemplify):\n                siemplify.LOGGER.info(f\"Pushing {playbook['name']}\")\n                playbook = gitsync.api.get_playbook(\n                    chronicle_soar=siemplify,\n                    identifier=playbook[\"identifier\"],\n                )\n                workflow = Workflow(playbook)\n                workflow.update_instance_name_in_steps(gitsync.api, siemplify)\n                gitsync.content.push_playbook(workflow)\n\n        # Jobs\n        if features[\"Jobs\"]:\n            siemplify.LOGGER.info(\"========== Jobs ==========\")\n            for job in [\n                x\n                for x in gitsync.api.get_jobs(chronicle_soar=siemplify)\n                if x.get(\"displayName\", x.get(\"name\")) not in IGNORED_JOBS\n                and x.get(\"integration\") != INTEGRATION_NAME\n                and not x.get(\"displayName\", x.get(\"name\")).startswith(\"Cases Collector DB\")\n                and not x.get(\"displayName\", x.get(\"name\")).startswith(\"Logs Collector\")\n            ]:\n                siemplify.LOGGER.info(f\"Pushing {job.get('displayName', job.get('name'))}\")\n                gitsync.content.push_job(Job(job))\n\n        # Connectors\n        if features[\"Connectors\"]:\n            siemplify.LOGGER.info(\"========== Connectors ==========\")\n            for connector in gitsync.api.get_connectors(chronicle_soar=siemplify):\n                siemplify.LOGGER.info(f\"Pushing {connector['displayName']}\")\n                gitsync.content.push_connector(Connector(connector))\n\n        # Simulated Cases\n        if features[\"Simulated Cases\"]:\n            siemplify.LOGGER.info(\"========== Simulated Cases ==========\")\n            for case in gitsync.api.get_simulated_cases():\n                siemplify.LOGGER.info(f\"Pushing {case}\")\n                gitsync.content.push_simulated_case(\n                    case,\n                    gitsync.api.export_simulated_case(case),\n                )\n\n        # Integration Instances\n        if features[\"Integration Instances\"]:\n            siemplify.LOGGER.info(\"========== Integration Instances ==========\")\n            integration_instances = []\n            for environment in gitsync.api.get_environment_names(chronicle_soar=siemplify) + [\n                ALL_ENVIRONMENTS_IDENTIFIER,\n            ]:\n                for instance in [\n                    x\n                    for x in gitsync.api.get_integrations_instances(\n                        chronicle_soar=siemplify, environment=environment\n                    )\n                    if x.integration_identifier not in IGNORED_INTEGRATIONS\n                ]:\n                    siemplify.LOGGER.info(f\"Pushing {instance.instance_name}\")\n                    settings = gitsync.api.get_integration_instance_settings(\n                        chronicle_soar=siemplify,\n                        instance_id=instance.identifier,\n                        integration_identifier=instance.integration_identifier,\n                    )\n                    for sett in (\n                        settings\n                    ):  # Remove Agent Identifiers from settings - should be created separately\n                        if sett.property_name == \"AgentIdentifier\":\n                            sett.value = None\n                    if commit_passwords:\n                        try:\n                            secrets = siemplify.get_configuration(instance.identifier)\n                            for prop in settings:\n                                if prop.is_password:\n                                    try:\n                                        prop.value = secrets[prop.property_name]\n                                    except KeyError:\n                                        siemplify.LOGGER.warn(\n                                            f\"{instance.instance_name} was updated with new \"\n                                            \"parameters but they weren't configured.\",\n                                        )\n                        except Exception:\n                            siemplify.LOGGER.warn(\n                                f\"{instance.identifier} is not configured. Skipping passwords\",\n                            )\n                    settings_dict_list = [\n                        {\n                            \"propertyName\": s.property_name,\n                            \"value\": s.value,\n                            \"creationTimeUnixTimeInMs\": 0,\n                            \"modificationTimeUnixTimeInMs\": 0,\n                            \"propertyType\": s.property_type,\n                            \"isMandatory\": s.is_mandatory,\n                            \"id\": s._id,\n                            \"propertyDisplayName\": s.display_name,\n                            \"propertyDescription\": s.property_description,\n                            \"integrationIdentifier\": instance.integration_identifier,\n                            \"integrationInstance\": instance.identifier,\n                        }\n                        for s in settings\n                    ]\n                    integration_instances.append(\n                        {\n                            \"environment\": environment,\n                            \"integrationIdentifier\": instance.integration_identifier,\n                            \"settings\": {\n                                \"instanceDescription\": instance.instance_description,\n                                \"instanceName\": instance.instance_name,\n                                \"settings\": settings_dict_list,\n                            },\n                        },\n                    )\n            gitsync.content.push_integration_instances(integration_instances)\n\n        # Ontology - Visual Families\n        if features[\"Visual Families\"]:\n            siemplify.LOGGER.info(\"========== Visual Families ==========\")\n            for visualFamily in gitsync.api.get_custom_families(chronicle_soar=siemplify):\n                siemplify.LOGGER.info(f\"Pushing {visualFamily['family']}\")\n                gitsync.content.push_visual_family(\n                    VisualFamily(\n                        gitsync.api.get_custom_family(\n                            chronicle_soar=siemplify,\n                            family_id=visualFamily[\"id\"],\n                        ),\n                    ),\n                )\n\n        # Ontology - Mappings\n        if features[\"Mappings\"]:\n            siemplify.LOGGER.info(\"========== Mappings ==========\")\n            all_records = gitsync.api.get_ontology_records(chronicle_soar=siemplify)\n            records_integrations = set([x[\"source\"] for x in all_records])\n            for integration in records_integrations:\n                siemplify.LOGGER.info(f\"Pushing {integration} mappings\")\n                if integration:\n                    records = [x for x in all_records if x[\"source\"] == integration]\n                    if not records:\n                        continue\n                    rules = []\n                    for record in records:\n                        record[\"exampleEventFields\"] = []  # remove event assets\n                        rule = gitsync.api.get_mapping_rules(\n                            record[\"source\"],\n                            record[\"product\"],\n                            record[\"eventName\"],\n                        )\n                        for r in rule[\"familyFields\"] + rule[\"systemFields\"]:\n                            # remove bad rules with no source\n                            if (\n                                r[\"mappingRule\"][\"source\"]\n                                and r[\"mappingRule\"][\"source\"].lower() == integration.lower()\n                            ):\n                                rules.append(rule)\n                                break\n\n                    gitsync.content.push_mapping(Mapping(integration, records, rules))\n\n        # Other settings\n        siemplify.LOGGER.info(\"========== Settings ==========\")\n        if features[\"Environments\"]:\n            siemplify.LOGGER.info(\"Pushing environments\")\n            environments = gitsync.api.get_environments(siemplify)\n            for environment in environments:\n                environment._id = 0\n            gitsync.content.push_environments([\n                environment.to_json() for environment in environments\n            ])\n\n        if features[\"Dynamic Parameters\"]:\n            siemplify.LOGGER.info(\"Pushing dynamic parameters\")\n            gitsync.content.push_dynamic_parameters(\n                gitsync.api.get_env_dynamic_parameters(chronicle_soar=siemplify),\n            )\n\n        if features[\"Logo\"]:\n            siemplify.LOGGER.info(\"Pushing logo\")\n            logo = gitsync.api.get_logo()\n            if logo[\"imageBase64\"]:\n                # A custom logo is configured.\n                logo[\"imageBase64\"] = \"data:image/png;base64,\" + logo[\"imageBase64\"]\n            gitsync.content.push_logo(logo)\n\n        if features[\"Case Tags\"]:\n            siemplify.LOGGER.info(\"Pushing case tags\")\n            gitsync.content.push_tags(gitsync.api.get_case_tags(chronicle_soar=siemplify))\n\n        if features[\"Case Stages\"]:\n            siemplify.LOGGER.info(\"Pushing case stages\")\n            gitsync.content.push_stages(gitsync.api.get_case_stages(chronicle_soar=siemplify))\n\n        if features[\"Case Title Settings\"]:\n            siemplify.LOGGER.info(\"Pushing case title settings\")\n            gitsync.content.push_case_titles(gitsync.api.get_case_title_settings())\n\n        if features[\"Case Close Reasons\"]:\n            siemplify.LOGGER.info(\"Pushing case close reasons\")\n            gitsync.content.push_case_close_causes(\n                gitsync.api.get_close_reasons(chronicle_soar=siemplify)\n            )\n\n        if features[\"Networks\"]:\n            siemplify.LOGGER.info(\"Pushing networks\")\n            gitsync.content.push_networks(gitsync.api.get_networks(chronicle_soar=siemplify))\n\n        if features[\"Domains\"]:\n            siemplify.LOGGER.info(\"Pushing domains\")\n            gitsync.content.push_domains(gitsync.api.get_domains(chronicle_soar=siemplify))\n\n        if features[\"Custom Lists\"]:\n            siemplify.LOGGER.info(\"Pushing custom lists\")\n            gitsync.content.push_custom_lists(\n                gitsync.api.get_custom_lists(chronicle_soar=siemplify)\n            )\n\n        if features[\"Email Templates\"]:\n            siemplify.LOGGER.info(\"Pushing email templates\")\n            gitsync.content.push_email_templates(\n                gitsync.api.get_email_templates(chronicle_soar=siemplify)\n            )\n\n        if features[\"Blacklists\"]:\n            siemplify.LOGGER.info(\"Pushing denylists\")\n            gitsync.content.push_denylists(gitsync.api.get_denylists(chronicle_soar=siemplify))\n\n        if features[\"SLA Records\"]:\n            siemplify.LOGGER.info(\"Pushing SLA records\")\n            gitsync.content.push_sla_definitions(\n                gitsync.api.get_sla_records(chronicle_soar=siemplify)\n            )\n\n        siemplify.LOGGER.info(\"Done! uploading everything to git\")\n        gitsync.commit_and_push(commit_msg)\n\n    except Exception as e:\n        siemplify.LOGGER.error(f\"General error performing Job {SCRIPT_NAME}\")\n        siemplify.LOGGER.exception(e)\n        raise\n\n    siemplify.end_script()\n\n\nif __name__ == \"__main__\":\n    main()\n",
    "creator": "397c1695-b131-4755-99dc-a2de22acf66f",
    "description": "Push all content of this platform to git",
    "isEnabled": false,
    "isCustom": true,
    "version": 1,
    "parameters": [
        {
            "id": 2251,
            "isMandatory": true,
            "name": "Commit",
            "type": 2,
            "value": "First Commit"
        },
        {
            "id": 2252,
            "isMandatory": false,
            "name": "Repo URL",
            "type": 2,
            "value": "https://github.com/rahul-rk-legend/gitsync_playground_legacy.git"
        },
        {
            "id": 2253,
            "isMandatory": false,
            "name": "Branch",
            "type": 2,
            "value": "main"
        },
        {
            "id": 2254,
            "isMandatory": false,
            "name": "Git Server Fingerprint",
            "type": 2,
            "value": ""
        },
        {
            "id": 2255,
            "isMandatory": false,
            "name": "Commit Author",
            "type": 2,
            "value": "rahul-rk-legend <rkumbhar@google.com>"
        },
        {
            "id": 2256,
            "isMandatory": false,
            "name": "Commit Passwords",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2257,
            "isMandatory": false,
            "name": "Integrations",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2258,
            "isMandatory": false,
            "name": "Playbooks",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2259,
            "isMandatory": false,
            "name": "Jobs",
            "type": 0,
            "value": "true"
        },
        {
            "id": 2260,
            "isMandatory": false,
            "name": "Connectors",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2261,
            "isMandatory": false,
            "name": "Integration Instances",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2262,
            "isMandatory": false,
            "name": "Visual Families",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2263,
            "isMandatory": false,
            "name": "Mappings",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2264,
            "isMandatory": false,
            "name": "Environments",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2265,
            "isMandatory": false,
            "name": "Dynamic Parameters",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2266,
            "isMandatory": false,
            "name": "Logo",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2267,
            "isMandatory": false,
            "name": "Case Tags",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2268,
            "isMandatory": false,
            "name": "Case Stages",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2269,
            "isMandatory": false,
            "name": "Case Title Settings",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2270,
            "isMandatory": false,
            "name": "Case Close Reasons",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2271,
            "isMandatory": false,
            "name": "Networks",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2272,
            "isMandatory": false,
            "name": "Domains",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2273,
            "isMandatory": false,
            "name": "Custom Lists",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2274,
            "isMandatory": false,
            "name": "Email Templates",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2275,
            "isMandatory": false,
            "name": "Blacklists",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2276,
            "isMandatory": false,
            "name": "SLA Records",
            "type": 0,
            "value": "false"
        },
        {
            "id": 2277,
            "isMandatory": false,
            "name": "Simulated Cases",
            "type": 0,
            "value": "false"
        }
    ],
    "runIntervalInSeconds": 18000,
    "creationTime": "2025-12-05T05:39:32.832Z",
    "lastModificationTime": "2025-12-05T05:46:45.837Z",
    "isSystemJob": false,
    "jobDefinitionName": "Push Content",
    "agentIdentifier": "",
    "advanced": false,
    "advancedConfig": {
        "timeZone": "Europe/London",
        "scheduleType": "Once",
        "oneTimeSchedule": {
            "startDate": {
                "year": 2025,
                "month": 12,
                "day": 6
            },
            "time": {
                "hours": 5,
                "minutes": 38,
                "seconds": 0,
                "nanos": 0
            },
            "interval": 0
        },
        "dailySchedule": null,
        "weeklySchedule": null,
        "monthlySchedule": null
    }
}